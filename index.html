
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Banca</title>
</head>
<body>
  <h2>Registro de Usuario</h2>
  <input type="text" id="nombre" placeholder="Tu nombre"><br><br>
  <input type="text" id="codigo" placeholder="Código de invitación"><br><br>
  <button onclick="registrarUsuario()">Registrarse</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAfokPF39lK8KLmli2isWseQxDT9yWQbAg",
      authDomain: "mi-banca-fcf37.firebaseapp.com",
      databaseURL: "https://mi-banca-fcf37-default-rtdb.firebaseio.com",
      projectId: "mi-banca-fcf37",
      storageBucket: "mi-banca-fcf37.appspot.com",
      messagingSenderId: "881335101774",
      appId: "1:881335101774:web:c496e479c988cf6cd6561f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.registrarUsuario = function () {
      const nombre = document.getElementById("nombre").value;
      const codigo = document.getElementById("codigo").value;

      if (!nombre || !codigo) {
        alert("Por favor completa todos los campos.");
        return;
      }

      const dbRef = ref(db);
      get(child(dbRef, `codigos/${codigo}`)).then((snapshot) => {
        if (snapshot.exists()) {
          const uid = Math.random().toString(36).substring(2, 15);
          set(ref(db, 'users/' + uid), {
            nombre: nombre,
            saldo: 0,
            solicitado: false
          }).then(() => {
            alert("Usuario registrado correctamente.");
          }).catch((error) => {
            alert("Error al registrar: " + error);
          });
        } else {
          alert("Código de invitación no válido.");
        }
      }).catch((error) => {
        alert("Error al verificar código: " + error);
      });
    };
  </script>
</body>
</html>
